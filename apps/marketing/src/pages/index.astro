---
import Layout from '../layouts/Layout.astro';
---

<Layout>
  <main>
    <!-- ── HERO ─────────────────────────────────────────── -->
    <section class="pt-20 pb-0">
      <div class="max-w-[1080px] mx-auto px-6">

        <!-- Brand -->
        <a href="/" class="inline-flex items-center gap-2 font-display text-sm font-semibold text-fg tracking-tight mb-10">
          <svg width="18" height="18" viewBox="0 0 278 277" fill="none">
            <path d="M198.033 0.727C240.224 -5.344 278 27.386 278 70.011c0 17.711-6.668 34.277-18 46.857v86.356c-.167-.001-.333-.003-.5-.003-40.041 0-72.5 32.459-72.5 72.5 0 .167.002.334.003.5H53c-18.778 0-34-15.222-34-34V117.955C7.062 105.25 0 88.237 0 70.011 0 27.386 37.776-5.344 79.967.727l47.639 6.854c7.557 1.088 15.231 1.088 22.788 0l47.639-6.854z" fill="currentColor"/>
          </svg>
          <span>breadcrumb</span>
        </a>

        <!-- Heading block -->
        <div class="max-w-2xl mb-16">
          <h1 class="font-display text-[clamp(38px,5.5vw,64px)] font-semibold leading-[1.06] tracking-[-0.03em] text-fg mb-5">
            Stop guessing what<br />your AI is doing.
          </h1>
          <p class="text-[17px] leading-[1.65] text-fg-2 max-w-[480px] mb-8">
            Breadcrumb logs every LLM call your app makes — prompts, completions,
            token counts, latency, cost. When something breaks, you'll know
            exactly where and why.
          </p>
          <form id="home-cta" class="flex gap-2 max-w-sm" novalidate>
            <input
              type="email" name="email" required
              placeholder="you@company.com"
              class="flex-1 min-w-0 px-3.5 py-2.5 text-sm text-fg bg-white border border-border rounded-lg outline-none placeholder:text-fg-3 focus:border-fg transition-colors font-display"
            />
            <button
              type="submit"
              class="shrink-0 px-4 py-2.5 bg-fg text-white text-sm font-medium rounded-lg hover:opacity-80 active:scale-[0.98] transition-[opacity,transform] font-display whitespace-nowrap"
            >
              Get early access
            </button>
          </form>
        </div>

        <!-- ── Animated live trace feed ────────────────── -->
        <div class="border border-border rounded-xl overflow-hidden shadow-[0_20px_60px_rgba(0,0,0,0.07),0_4px_16px_rgba(0,0,0,0.04)]">

          <!-- Browser chrome -->
          <div class="flex items-center gap-2.5 px-4 py-[10px] bg-[#f0f0f0] border-b border-[#e0e0e0]">
            <div class="flex gap-[5px] shrink-0">
              <span class="block w-[10px] h-[10px] rounded-full bg-[#d0d0d0]"></span>
              <span class="block w-[10px] h-[10px] rounded-full bg-[#d0d0d0]"></span>
              <span class="block w-[10px] h-[10px] rounded-full bg-[#d0d0d0]"></span>
            </div>
            <span class="font-mono text-[11px] text-[#999] flex-1 text-center mr-[88px]">
              app.breadcrumb.sh / my-project / traces
            </span>
          </div>

          <!-- App shell -->
          <div class="grid grid-cols-[176px_1fr] min-h-[420px]">

            <!-- Sidebar -->
            <aside class="border-r border-[#ebebeb] py-5 flex flex-col bg-[#faf9f7]">
              <div class="flex items-center gap-[7px] px-4 pb-5 border-b border-[#ebebeb] mb-2 font-display text-[12px] font-semibold text-fg">
                <svg width="13" height="13" viewBox="0 0 278 277" fill="none">
                  <path d="M198.033 0.727C240.224 -5.344 278 27.386 278 70.011c0 17.711-6.668 34.277-18 46.857v86.356c-.167-.001-.333-.003-.5-.003-40.041 0-72.5 32.459-72.5 72.5 0 .167.002.334.003.5H53c-18.778 0-34-15.222-34-34V117.955C7.062 105.25 0 88.237 0 70.011 0 27.386 37.776-5.344 79.967.727l47.639 6.854c7.557 1.088 15.231 1.088 22.788 0l47.639-6.854z" fill="currentColor"/>
                </svg>
                my-project
              </div>
              <nav class="flex flex-col gap-px px-2 flex-1 pt-1">
                {[
                  { label: 'Traces',  active: true  },
                  { label: 'Spans',   active: false },
                  { label: 'Latency', active: false },
                  { label: 'Costs',   active: false },
                ].map(({ label, active }) => (
                  <span class:list={[
                    'flex items-center px-2.5 py-[7px] text-[12px] rounded-md cursor-default font-display',
                    active
                      ? 'bg-white text-fg font-medium border border-[#e8e8e8] shadow-sm'
                      : 'text-[#bbb]',
                  ]}>
                    {label}
                  </span>
                ))}
              </nav>
              <div class="px-2 pt-2 border-t border-[#ebebeb]">
                <span class="flex items-center px-2.5 py-[7px] text-[12px] text-[#bbb] rounded-md cursor-default font-display">
                  Settings
                </span>
              </div>
            </aside>

            <!-- Live feed -->
            <div class="flex flex-col bg-white">

              <!-- Feed header -->
              <div class="flex items-center justify-between px-5 py-[11px] border-b border-[#ebebeb]">
                <div class="flex items-center gap-[7px]">
                  <span class="relative flex h-[7px] w-[7px]">
                    <span class="live-ping absolute inset-0 rounded-full" style="background:#22c08b;opacity:0.45"></span>
                    <span class="relative rounded-full h-[7px] w-[7px]" style="background:#22c08b"></span>
                  </span>
                  <span class="font-display text-[13px] font-semibold text-fg">Live feed</span>
                </div>
                <div class="flex gap-[5px]">
                  <span class="font-mono text-[10px] px-[7px] py-[2px] rounded-[4px]" style="color:#c97020;background:#fff8f0;border:1px solid #ffe0c0">LLM</span>
                  <span class="font-mono text-[10px] px-[7px] py-[2px] rounded-[4px]" style="color:#15876a;background:#edfaf5;border:1px solid #b7f0db">Tool</span>
                  <span class="font-mono text-[10px] px-[7px] py-[2px] rounded-[4px]" style="color:#5849d4;background:#f3f0ff;border:1px solid #ddd8fc">Span</span>
                  <span class="font-mono text-[10px] px-[7px] py-[2px] rounded-[4px]" style="color:#b03d90;background:#fdf0f7;border:1px solid #f5c0e5">Embed</span>
                </div>
              </div>

              <!-- Scrolling events -->
              <div class="relative flex-1" style="min-height:354px;overflow:hidden">
                <!-- Top fade mask -->
                <div class="absolute top-0 left-0 right-0 h-16 pointer-events-none z-10"
                     style="background:linear-gradient(to bottom,white 10%,transparent 100%)"></div>
                <!-- Events stack -->
                <div id="trace-inner"
                     class="absolute inset-0 flex flex-col justify-end gap-[4px] px-4 py-4 overflow-hidden">
                  <!-- populated by JS -->
                </div>
              </div>

            </div>
          </div>
        </div>
        <!-- end animated feed -->

      </div>
    </section>

    <!-- ── FEATURES ───────────────────────────────────────── -->
    <section class="border-t border-border mt-20 py-24">
      <div class="max-w-[1080px] mx-auto px-6">
        <div class="grid grid-cols-3 gap-3">

          {[
            {
              label: 'Full trace visibility',
              body:  "Every LLM call gets logged — prompt, completion, token count, latency, cost. Nothing slips through.",
              icon: (
                <path d="M3 12l4-4 4 4 4-8 4 4" stroke="#c8903a" stroke-width="1.75" stroke-linecap="round" stroke-linejoin="round"/>
              ),
            },
            {
              label: 'Debug without guessing',
              body:  "Trace any bad output back to the exact prompt that caused it. No more adding console.logs to your LLM calls.",
              icon: (
                <><circle cx="11" cy="11" r="7" stroke="#c8903a" stroke-width="1.75"/><path d="M16.5 16.5L21 21" stroke="#c8903a" stroke-width="1.75" stroke-linecap="round"/></>
              ),
            },
            {
              label: 'Understand your costs',
              body:  "Track spend per user, per feature, per conversation. Know what's driving your API bill before it's a problem.",
              icon: (
                <path d="M12 2v20M2 12h20" stroke="#c8903a" stroke-width="1.75" stroke-linecap="round"/>
              ),
            },
          ].map((f) => (
            <div class="p-8 border border-border rounded-xl hover:bg-surface transition-colors">
              <div class="w-9 h-9 border border-border rounded-lg flex items-center justify-center mb-5 bg-surface">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none">
                  <Fragment set:html={f.icon} />
                </svg>
              </div>
              <h3 class="font-display text-[15px] font-semibold text-fg mb-2.5 tracking-tight">{f.label}</h3>
              <p class="text-sm leading-[1.65] text-fg-2">{f.body}</p>
            </div>
          ))}

        </div>
      </div>
    </section>

    <!-- ── BOTTOM CTA ─────────────────────────────────────── -->
    <section class="pb-24">
      <div class="max-w-[1080px] mx-auto px-6">
        <div class="bg-surface border border-border rounded-2xl px-12 py-16 text-center">
          <h2 class="font-display text-[clamp(22px,3vw,34px)] font-semibold tracking-tight text-fg mb-3">
            Ready to see what's actually happening?
          </h2>
          <p class="text-[15px] text-fg-2 mb-8">Join the waitlist. We'll reach out when it's ready.</p>
          <a
            href="/early-access"
            class="inline-flex items-center gap-1.5 px-5 py-2.5 bg-fg text-white text-sm font-medium rounded-lg hover:opacity-80 active:scale-[0.98] transition-[opacity,transform]"
          >
            Get early access
          </a>
        </div>
      </div>
    </section>
  </main>

  <!-- ── FOOTER ─────────────────────────────────────────── -->
  <footer class="border-t border-border py-6">
    <div class="max-w-[1080px] mx-auto px-6 flex items-center justify-between">
      <a href="/" class="flex items-center gap-2 font-display text-[13px] font-medium text-[#bbb]">
        <svg width="14" height="14" viewBox="0 0 278 277" fill="none">
          <path d="M198.033 0.727C240.224 -5.344 278 27.386 278 70.011c0 17.711-6.668 34.277-18 46.857v86.356c-.167-.001-.333-.003-.5-.003-40.041 0-72.5 32.459-72.5 72.5 0 .167.002.334.003.5H53c-18.778 0-34-15.222-34-34V117.955C7.062 105.25 0 88.237 0 70.011 0 27.386 37.776-5.344 79.967.727l47.639 6.854c7.557 1.088 15.231 1.088 22.788 0l47.639-6.854z" fill="currentColor"/>
        </svg>
        breadcrumb
      </a>
      <p class="text-xs text-[#ccc]">&copy; 2025 Breadcrumb</p>
    </div>
  </footer>

<style>
  /* Live indicator pulse */
  .live-ping {
    animation: livePing 2s cubic-bezier(0, 0, 0.2, 1) infinite;
  }
  @keyframes livePing {
    75%, 100% { transform: scale(2.8); opacity: 0; }
  }

  /* Row slide-in */
  .row-enter {
    animation: rowIn 0.24s cubic-bezier(0.16, 1, 0.3, 1) both;
  }
  @keyframes rowIn {
    from { opacity: 0; transform: translateY(7px); }
    to   { opacity: 1; transform: translateY(0); }
  }

  /* Streaming cursor on LLM spans */
  .streaming-cursor::after {
    content: '▋';
    animation: cursorBlink 0.75s step-end infinite;
    margin-left: 2px;
    font-size: 9px;
    opacity: 0.55;
  }
  @keyframes cursorBlink {
    50% { opacity: 0; }
  }
</style>

<script>
  // ── Home CTA ──────────────────────────────────────────────────
  document.getElementById('home-cta')?.addEventListener('submit', (e) => {
    e.preventDefault();
    const email = (e.currentTarget as HTMLFormElement)
      .querySelector<HTMLInputElement>('[name=email]')?.value.trim();
    if (email) window.location.href = `/early-access?email=${encodeURIComponent(email)}`;
  });

  // ── Animated trace feed ───────────────────────────────────────

  const TYPES = {
    llm:   { label: 'LLM',   color: '#f59332', bg: '#fff8f0', text: '#c97020', border: '#ffe0c0' },
    tool:  { label: 'Tool',  color: '#22c08b', bg: '#edfaf5', text: '#15876a', border: '#b7f0db' },
    chain: { label: 'Span',  color: '#7c6ef5', bg: '#f3f0ff', text: '#5849d4', border: '#ddd8fc' },
    embed: { label: 'Embed', color: '#e05fb5', bg: '#fdf0f7', text: '#b03d90', border: '#f5c0e5' },
  } as const;

  type SpanType = keyof typeof TYPES;

  interface Span {
    type: SpanType;
    name: string;
    ms: number;
    detail?: string;
    tokens?: string;
  }
  interface Trace {
    id: string;
    spans: Span[];
    error?: boolean;
  }

  const TRACES: Trace[] = [
    {
      id: 'tr_4f2a8c3d',
      spans: [
        { type: 'chain', name: 'chat_pipeline',           ms: 1240 },
        { type: 'tool',  name: 'retrieve_context',        ms: 48,   detail: '3 docs' },
        { type: 'llm',   name: 'gpt-4o',                 ms: 891,  tokens: '1,247' },
      ],
    },
    {
      id: 'tr_8b1e9f7c',
      spans: [
        { type: 'chain', name: 'agent_loop',              ms: 2341 },
        { type: 'llm',   name: 'claude-3.5-sonnet',      ms: 334,  tokens: '312' },
        { type: 'tool',  name: 'web_search',              ms: 89,   detail: '"Q3 revenue"' },
        { type: 'tool',  name: 'format_response',         ms: 4,    detail: 'md → text' },
        { type: 'llm',   name: 'claude-3.5-sonnet',      ms: 445,  tokens: '567' },
      ],
    },
    {
      id: 'tr_2c6d4a1b',
      spans: [
        { type: 'llm',   name: 'gpt-4o-mini',            ms: 128,  tokens: '234' },
      ],
    },
    {
      id: 'tr_9e3f7b5a',
      spans: [
        { type: 'chain', name: 'embedding_pipeline',      ms: 87 },
        { type: 'embed', name: 'text-embedding-3-small',  ms: 67,   tokens: '3,891' },
      ],
    },
    {
      id: 'tr_1d8c2e4f',
      spans: [
        { type: 'chain', name: 'chat_pipeline',           ms: 1590 },
        { type: 'tool',  name: 'check_cache',             ms: 3,    detail: 'miss' },
        { type: 'llm',   name: 'gpt-4o',                 ms: 1240, tokens: '2,134' },
      ],
    },
    {
      id: 'tr_7e5c3b1a',
      spans: [
        { type: 'chain', name: 'summarize_thread',        ms: 980 },
        { type: 'tool',  name: 'fetch_messages',          ms: 22,   detail: '14 messages' },
        { type: 'llm',   name: 'gpt-4o',                 ms: 712,  tokens: '892' },
      ],
    },
  ];

  const feed = document.getElementById('trace-inner')!;
  const MAX_ROWS = 11;

  function prune() {
    while (feed.children.length > MAX_ROWS) {
      feed.removeChild(feed.firstChild!);
    }
  }

  function makeSpanRow(span: Span, streaming = false): HTMLElement {
    const t = TYPES[span.type];
    const el = document.createElement('div');
    el.className = 'row-enter flex items-center gap-[7px] px-[10px] py-[7px] rounded-[7px] shrink-0';
    el.style.cssText = `background:${t.bg};border-left:2.5px solid ${t.color};`;

    const badge   = `<span class="shrink-0 font-mono text-[10px] font-semibold px-[5px] py-[2px] rounded-[3px]" style="color:${t.text};background:white;border:1px solid ${t.border}">${t.label}</span>`;
    const name    = `<span class="font-display text-[12px] font-medium flex-1 min-w-0 truncate${streaming ? ' streaming-cursor' : ''}" style="color:#1a1a1a">${span.name}</span>`;
    const detail  = span.detail ? `<span class="font-mono text-[11px] shrink-0 max-w-[88px] truncate" style="color:#aaa">${span.detail}</span>` : '';
    const ms      = !streaming ? `<span class="font-mono text-[10px] shrink-0" style="color:#ccc">${span.ms}ms</span>` : '';
    const tokens  = span.tokens && !streaming ? `<span class="font-mono text-[10px] font-semibold shrink-0" style="color:${t.text}">${span.tokens}</span>` : '';

    el.innerHTML = badge + name + detail + ms + tokens;
    return el;
  }

  function makeTraceSep(trace: Trace): HTMLElement {
    const el = document.createElement('div');
    el.className = 'row-enter flex items-center gap-[7px] px-[2px] shrink-0 my-[2px]';
    el.innerHTML = `
      <span class="font-mono text-[10px]" style="color:#d0d0d0">${trace.id}</span>
      <div class="flex-1 h-px" style="background:#ebebeb"></div>
      <span class="w-[6px] h-[6px] rounded-full shrink-0" style="background:${trace.error ? '#ef4444' : '#22c08b'}"></span>
    `;
    return el;
  }

  const sleep = (ms: number) => new Promise<void>(r => setTimeout(r, ms));

  async function runDemo() {
    let idx = 0;
    while (true) {
      const trace = TRACES[idx++ % TRACES.length];
      await sleep(700);

      for (let i = 0; i < trace.spans.length; i++) {
        const span = trace.spans[i];
        const isLastLLM = span.type === 'llm' && i === trace.spans.length - 1;

        await sleep(420);
        prune();

        if (isLastLLM) {
          // Show streaming state for the final LLM span
          const streamRow = makeSpanRow(span, true);
          feed.appendChild(streamRow);
          await sleep(Math.min(span.ms, 900));

          // Complete: remove cursor, add stats inline
          streamRow.querySelector('.streaming-cursor')?.classList.remove('streaming-cursor');
          const t = TYPES[span.type];

          const msEl = document.createElement('span');
          msEl.className = 'font-mono text-[10px] shrink-0';
          msEl.style.color = '#ccc';
          msEl.textContent = `${span.ms}ms`;
          streamRow.appendChild(msEl);

          if (span.tokens) {
            const tokEl = document.createElement('span');
            tokEl.className = 'font-mono text-[10px] font-semibold shrink-0';
            tokEl.style.color = t.text;
            tokEl.textContent = span.tokens;
            streamRow.appendChild(tokEl);
          }
        } else {
          feed.appendChild(makeSpanRow(span));
        }
      }

      await sleep(500);
      prune();
      feed.appendChild(makeTraceSep(trace));
    }
  }

  runDemo();
</script>
</Layout>
